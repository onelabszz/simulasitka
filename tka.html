<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CBT TKA SD - Login System</title>
    <style>
        /* CSS DASAR SAMA SEPERTI SEBELUMNYA */
        :root { --primary: #1565c0; --accent: #ff6f00; --text: #333; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: #f0f2f5; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* HEADER & LAYOUT */
        header { background: var(--primary); color: white; height: 60px; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .app-info { font-weight: bold; display: flex; gap: 15px; align-items: center; }
        .user-badge { background: rgba(255,255,255,0.2); padding: 5px 12px; border-radius: 15px; font-size: 0.85rem; }
        .timer { background: #fff; color: var(--primary); padding: 5px 15px; border-radius: 4px; font-weight: bold; }

        .container { display: flex; flex: 1; overflow: hidden; }
        
        /* SIDEBAR NAVIGASI */
        .sidebar { width: 280px; background: white; border-right: 1px solid #ddd; display: flex; flex-direction: column; }
        .nav-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; padding: 15px; overflow-y: auto; }
        .nav-item { aspect-ratio: 1; border: 1px solid #ccc; display: flex; justify-content: center; align-items: center; cursor: pointer; border-radius: 4px; transition: 0.2s; background: white; }
        .nav-item:hover { background: #e3f2fd; }
        .nav-item.active { background: var(--primary); color: white; border-color: var(--primary); }
        .nav-item.answered { background: #43a047; color: white; border-color: #43a047; }
        
        /* AREA UTAMA */
        .main-content { flex: 1; display: flex; background: white; }
        .stimulus-area { flex: 1; padding: 30px; border-right: 1px solid #eee; overflow-y: auto; background: #fff; max-width: 50%; }
        .question-area { flex: 1; padding: 30px; overflow-y: auto; background: #f9f9f9; }
        
        .stimulus-area h3 { color: var(--primary); margin-bottom: 15px; }
        .stimulus-area p { margin-bottom: 10px; line-height: 1.6; text-align: justify; }
        
        .question-text { font-size: 1.1rem; margin-bottom: 20px; font-weight: 500; }
        .option-group { display: flex; flex-direction: column; gap: 10px; }
        .option-item { display: flex; gap: 10px; padding: 12px; background: white; border: 1px solid #ccc; border-radius: 6px; cursor: pointer; transition: 0.2s; }
        .option-item:hover { border-color: var(--primary); background: #e3f2fd; }
        
        footer { height: 60px; border-top: 1px solid #ddd; background: white; display: flex; justify-content: flex-end; align-items: center; padding: 0 30px; gap: 10px; }
        .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; color: white; }
        .btn-prev { background: #757575; }
        .btn-next { background: var(--primary); }
        .btn-finish { background: #d32f2f; display: none; }

        /* --- LOGIN SCREEN (BARU) --- */
        .login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #e3f2fd; z-index: 1000; display: flex; justify-content: center; align-items: center; }
        .login-card { background: white; padding: 40px; border-radius: 10px; width: 400px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; }
        .login-card h2 { color: var(--primary); margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        .form-group input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-size: 1rem; }
        .btn-login { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 6px; font-weight: bold; font-size: 1rem; cursor: pointer; margin-top: 10px; }
        .btn-login:hover { background: #0d47a1; }
        .error-msg { color: red; font-size: 0.9rem; margin-top: 10px; display: none; }

        /* --- RESULT MODAL --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 900; display: none; justify-content: center; align-items: center; }
        .result-box { background: white; padding: 30px; border-radius: 8px; width: 350px; text-align: center; animation: popUp 0.3s; }
        .score-circle { width: 100px; height: 100px; background: var(--primary); color: white; font-size: 2rem; font-weight: bold; border-radius: 50%; display: flex; justify-content: center; align-items: center; margin: 20px auto; }
        @keyframes popUp { from { transform: scale(0.8); } to { transform: scale(1); } }
    </style>
</head>
<body>

    <div class="login-overlay" id="loginScreen">
        <div class="login-card">
            <h2>CBT TKA SD 2025</h2>
            <div class="form-group">
                <label>Nama Peserta</label>
                <input type="text" id="inputNama" placeholder="Contoh: Budi Santoso">
            </div>
            <div class="form-group">
                <label>Kode Soal / Token</label>
                <input type="text" id="inputToken" placeholder="Masukkan: SIMULASI" style="text-transform: uppercase;">
            </div>
            <button class="btn-login" onclick="startExam()">MULAI UJIAN</button>
            <p class="error-msg" id="errorMsg">Token salah! Gunakan token: SIMULASI</p>
            <p style="margin-top:20px; font-size:0.8rem; color:#666;">
                Token Tersedia:<br>
                <b>SIMULASI</b> (Urutan Standar)<br>
                <b>ACAK</b> (Pilihan Ganda Diacak)
            </p>
        </div>
    </div>

    <header>
        <div class="app-info">
            <span>TKA SD</span>
            <div class="user-badge" id="userNameDisplay">Peserta</div>
        </div>
        <div class="timer" id="timerDisplay">60:00</div>
    </header>

    <div class="container">
        <nav class="sidebar">
            <div style="padding:15px; font-weight:bold; border-bottom:1px solid #eee;">Nomor Soal</div>
            <div class="nav-grid" id="navGrid"></div>
        </nav>
        
        <main class="main-content">
            <div class="stimulus-area">
                <div id="stimulusContent"></div>
            </div>
            <div class="question-area">
                <div id="questionContent"></div>
            </div>
        </main>
    </div>

    <footer>
        <button class="btn btn-prev" id="btnPrev" onclick="navQuestion(-1)">Sebelumnya</button>
        <button class="btn btn-next" id="btnNext" onclick="navQuestion(1)">Selanjutnya</button>
        <button class="btn btn-finish" id="btnFinish" onclick="submitExam()">Selesai</button>
    </footer>

    <div class="modal-overlay" id="resultModal">
        <div class="result-box">
            <h3>Hasil Ujian</h3>
            <div class="score-circle" id="finalScore">0</div>
            <p>Jawaban Benar: <span id="correctCount">0</span> / <span id="totalCount">0</span></p>
            <button class="btn btn-next" style="margin-top:20px; width:100%;" onclick="location.reload()">Keluar</button>
        </div>
    </div>

<script>
    // === DATA BASE ===
    // Stimulus (Bacaan)
    const stimulusDB = {
        'S1': `<h3>Danau untuk Semua</h3><p>Di hutan ada danau tempat binatang minum. Rino si Badak berendam sehingga air keruh. Binatang lain takut menegur. Akhirnya Kancil punya ide cerdik untuk membujuk Rino pindah.</p>`,
        'S2': `<h3>Diskon Toko Buku</h3><p>Toko "Pintar" memberikan diskon 20% untuk semua buku cerita. Harga asli buku cerita adalah Rp25.000,00.</p>`
    };

    // Soal (Bisa diperbanyak)
    // Structure: id, stim, text, options [{txt, val}], key
    let questions = [
        {
            id: 1, stim: 'S1', type: 'PG',
            text: "Siapa tokoh yang membuat air danau menjadi keruh?",
            options: [
                {txt: "A. Kancil", val: "A"}, 
                {txt: "B. Rino si Badak", val: "B"}, 
                {txt: "C. Gajah", val: "C"}, 
                {txt: "D. Kelinci", val: "D"}
            ],
            key: "B" 
        },
        {
            id: 2, stim: 'S1', type: 'PG',
            text: "Mengapa hewan lain takut menegur Rino?",
            options: [
                {txt: "A. Karena Rino sangat galak", val: "A"}, 
                {txt: "B. Karena Rino bertubuh besar", val: "B"}, 
                {txt: "C. Karena Rino raja hutan", val: "C"}, 
                {txt: "D. Karena Rino punya sihir", val: "D"}
            ],
            key: "B"
        },
        {
            id: 3, stim: 'S2', type: 'PG',
            text: "Berapa rupiah besar potongan harga (diskon) buku tersebut?",
            options: [
                {txt: "A. Rp2.000,00", val: "A"}, 
                {txt: "B. Rp5.000,00", val: "B"}, 
                {txt: "C. Rp10.000,00", val: "C"}, 
                {txt: "D. Rp20.000,00", val: "D"}
            ],
            key: "B" // 20% x 25.000 = 5.000
        },
        {
            id: 4, stim: 'S2', type: 'PG',
            text: "Berapa uang yang harus dibayar untuk membeli 2 buku cerita?",
            options: [
                {txt: "A. Rp40.000,00", val: "A"}, 
                {txt: "B. Rp45.000,00", val: "B"}, 
                {txt: "C. Rp50.000,00", val: "C"}, 
                {txt: "D. Rp35.000,00", val: "D"}
            ],
            key: "A" // (25k-5k) * 2 = 40k
        }
    ];

    // STATE
    let currentIdx = 0;
    let userAnswers = {};
    let isRandomized = false;

    // --- LOGIC LOGIN & TOKEN ---
    function startExam() {
        const nama = document.getElementById('inputNama').value;
        const token = document.getElementById('inputToken').value.toUpperCase();
        
        if (token !== 'SIMULASI' && token !== 'ACAK') {
            document.getElementById('errorMsg').style.display = 'block';
            return;
        }

        // Simpan Nama
        document.getElementById('userNameDisplay').innerText = nama || 'Peserta';
        
        // Logika Kode Soal (Token)
        if (token === 'ACAK') {
            isRandomized = true;
            shuffleOptions(); // Jalankan pengacakan opsi
        }

        // Masuk ke Aplikasi
        document.getElementById('loginScreen').style.display = 'none';
        initApp();
        startTimer();
    }

    // --- ALGORITMA ACAK OPSI (FISHER-YATES) ---
    function shuffleOptions() {
        questions.forEach(q => {
            if (q.type === 'PG') {
                // Acak urutan array options
                for (let i = q.options.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [q.options[i], q.options[j]] = [q.options[j], q.options[i]];
                }
            }
        });
    }

    // --- CORE APP ---
    function initApp() {
        renderNav();
        loadQuestion(0);
    }

    function renderNav() {
        const grid = document.getElementById('navGrid');
        grid.innerHTML = '';
        questions.forEach((q, idx) => {
            const btn = document.createElement('div');
            btn.className = 'nav-item';
            btn.id = `nav-${idx}`;
            btn.innerText = idx + 1;
            btn.onclick = () => loadQuestion(idx);
            grid.appendChild(btn);
        });
    }

    function loadQuestion(idx) {
        currentIdx = idx;
        const q = questions[idx];
        
        // 1. Render Stimulus
        const stimArea = document.getElementById('stimulusContent');
        stimArea.innerHTML = stimulusDB[q.stim] || '<p>Tidak ada bacaan.</p>';

        // 2. Render Soal & Opsi
        const qArea = document.getElementById('questionContent');
        let html = `<div class="question-text">No. ${idx+1}. ${q.text}</div>`;
        html += `<div class="option-group">`;
        
        q.options.forEach((opt, i) => {
            // Cek apakah sudah dijawab sebelumnya
            const checked = userAnswers[idx] === opt.val ? 'checked' : '';
            
            // Render Opsi
            html += `
            <label class="option-item">
                <input type="radio" name="ans" value="${opt.val}" ${checked} onchange="saveAnswer('${opt.val}')">
                <span>${opt.txt}</span> 
            </label>`;
        });
        html += `</div>`;
        qArea.innerHTML = html;

        updateNavUI();
        updateButtons();
    }

    function saveAnswer(val) {
        userAnswers[currentIdx] = val;
        updateNavUI();
    }

    function updateNavUI() {
        // Hapus class active lama
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        // Set active baru
        const currentNav = document.getElementById(`nav-${currentIdx}`);
        if(currentNav) currentNav.classList.add('active');

        // Set status answered
        Object.keys(userAnswers).forEach(key => {
            document.getElementById(`nav-${key}`).classList.add('answered');
        });
    }

    function updateButtons() {
        document.getElementById('btnPrev').disabled = currentIdx === 0;
        if (currentIdx === questions.length - 1) {
            document.getElementById('btnNext').style.display = 'none';
            document.getElementById('btnFinish').style.display = 'block';
        } else {
            document.getElementById('btnNext').style.display = 'block';
            document.getElementById('btnFinish').style.display = 'none';
        }
    }

    function navQuestion(step) {
        const next = currentIdx + step;
        if (next >= 0 && next < questions.length) loadQuestion(next);
    }

    // --- SCORING ---
    function submitExam() {
        if(!confirm('Yakin ingin menyelesaikan ujian?')) return;

        let correct = 0;
        questions.forEach((q, idx) => {
            // Perhatian: Logic ini membandingkan Value (A, B, C, D)
            // Kunci Jawaban (key) tetap statis, misalnya "B".
            // Meskipun opsi diacak, value "B" tetap melekat pada jawaban yang benar.
            if (userAnswers[idx] === q.key) correct++;
        });

        const score = Math.round((correct / questions.length) * 100);
        
        document.getElementById('finalScore').innerText = score;
        document.getElementById('correctCount').innerText = correct;
        document.getElementById('totalCount').innerText = questions.length;
        document.getElementById('resultModal').style.display = 'flex';
    }

    function startTimer() {
        let time = 60 * 60; // 60 menit
        setInterval(() => {
            if(time <= 0) return;
            time--;
            const m = Math.floor(time/60).toString().padStart(2,'0');
            const s = (time%60).toString().padStart(2,'0');
            document.getElementById('timerDisplay').innerText = `${m}:${s}`;
        }, 1000);
    }
</script>

</body>
</html>
